#
# This will test If Gtid_log_event have thread_id info
#
--source include/have_binlog_format_row.inc
--source include/master-slave.inc

--connection slave
--source include/stop_slave.inc
RESET MASTER;
RESET SLAVE;
--source include/start_slave.inc

--connection master
RESET MASTER;
--let thread_id=`select connection_id()`
create table t1(a int);
insert into t1 values(1);
insert into t1 values(1);
set @@pseudo_thread_id=99999;
drop table t1;

--sync_slave_with_master
let datadir= `select @@datadir`;
let filename= slave-bin.000001;
let local=$datadir/slave-bin.000001;
let outfile=$MYSQLTEST_VARDIR/tmp/binlog.sql;
exec $MYSQL_BINLOG $local > $outfile;

--let SEARCH_FILE= $outfile
## Should be same as master thread_id $thread_id
--let SEARCH_PATTERN=GTID [0-9]-[0-9]-[0-9] trans thread_id=$thread_id\n
--echo #Only 2 matches
##replace the thread_id beacsue it an be different on different runs
--replace_regex /thread_id=[0-9]+/thread_id=master_thread_id /
--source include/search_pattern_in_file.inc

#Please note that \n after $thread_id is important otherwise it can match
#prefix of @@pseudo_thread_id set at master
--let SEARCH_PATTERN=GTID [0-9]-[0-9]-[0-9] ddl thread_id=$thread_id\n
--echo #Only 1 matches
--replace_regex /thread_id=[0-9]+/thread_id=master_thread_id /
--source include/search_pattern_in_file.inc

## Should be same as master pseudo_thread_id 99999
--let SEARCH_PATTERN=GTID [0-9]-[0-9]-[0-9] ddl thread_id=99999\n
--echo #Only 1 matches
--source include/search_pattern_in_file.inc
remove_file $outfile;

--source include/rpl_end.inc
